{% extends "two_factor/_base_focus.html" %}
{% load i18n %}
{% load static %}
{% block title %} Backup Phone {% endblock %}

{% block content %}
  <div class="backup_phone_form mt-4">
    <div class="row">
      <div class="col-12 col-md-8 offset-md-2 col-lg-8 offset-lg-2">
        <div class="card-body backup_phone_header">
          <h3 class="mb-1">{% trans "BACKUP PHONE" %}</h3>
        </div>
        <div class="card-body backup_phone_container">
          {% if wizard.steps.current == 'setup' %}
            <h6>{% blocktrans %}Backup phone number will be used if your primary method of registration is not available.{% endblocktrans %}</h6>
          {% elif wizard.steps.current == 'validation' %}
            <h6>{% blocktrans %}We've sent a token to your phone number. Please enter the token you've received.{% endblocktrans %}</h6>
          {% endif %}
          <form class="backup_form" action="" method="POST">
            {% csrf_token %}

            {% for field in form %}
              {% if field.errors %}
                <div class="custom_alert custom_alert-danger" style="margin: 12px 0;">
                  {{ field.errors }}
                </div>
              {% endif %}
            {% endfor %}

            <div class="backup_phone_group">
              {% include "two_factor/_wizard_forms_bp.html" %}

              {# hidden submit button to enable [enter] key #}
              <div style="margin-left: -9999px; overflow: hidden; float: left;"><input type="submit" value=""/></div>

              {% include "two_factor/_wizard_actions_bp.html" %}
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
{% block other_js %}
  <script>
    $(document).ready(function(){
      var backup_phone_input = $('#id_setup-number');
      var backup_token_input = $('#id_validation-token');

      var main_div = $('#id_setup-method');
      var backup_setup_phone = $('#id_setup-method_0');
      var backup_setup_call = $('#id_setup-method_1');

      main_div.wrap('<div class="cntr"><div class="form-group text-center checkbox_option mb-4"></div></div>');
      main_div.find("li").css("font-weight", 500);
      $("p label[for='id_setup-method_0']").addClass("text-center custom_backup_phone_method");
      $("li label[for='id_setup-method_0']").addClass("p-0 btn-radio form-check-label");
      $('<svg width="20px" height="20px" viewBox="0 0 20 20"><circle cx="10" cy="10" r="9"></circle><path d="M10,7 C8.34314575,7 7,8.34314575 7,10 C7,11.6568542 8.34314575,13 10,13 C11.6568542,13 13,11.6568542 13,10 C13,8.34314575 11.6568542,7 10,7 Z" class="inner"></path><path d="M10,1 L10,1 L10,1 C14.9705627,1 19,5.02943725 19,10 L19,10 L19,10 C19,14.9705627 14.9705627,19 10,19 L10,19 L10,19 C5.02943725,19 1,14.9705627 1,10 L1,10 L1,10 C1,5.02943725 5.02943725,1 10,1 L10,1 Z" class="outer"></path></svg>').insertAfter(backup_setup_phone);
      $("label[for='id_setup-method_1']").addClass("p-0 btn-radio form-check-label");
      $('<svg width="20px" height="20px" viewBox="0 0 20 20"><circle cx="10" cy="10" r="9"></circle><path d="M10,7 C8.34314575,7 7,8.34314575 7,10 C7,11.6568542 8.34314575,13 10,13 C11.6568542,13 13,11.6568542 13,10 C13,8.34314575 11.6568542,7 10,7 Z" class="inner"></path><path d="M10,1 L10,1 L10,1 C14.9705627,1 19,5.02943725 19,10 L19,10 L19,10 C19,14.9705627 14.9705627,19 10,19 L10,19 L10,19 C5.02943725,19 1,14.9705627 1,10 L1,10 L1,10 C1,5.02943725 5.02943725,1 10,1 L10,1 Z" class="outer"></path></svg>').insertAfter(backup_setup_call);
      backup_setup_call.attr('checked', true);

      backup_phone_input.wrap('<div class="input-group mb-3 backup_input_container"></div>').addClass("form-control").attr({
        "placeholder": "Phone Number",
      });
      $('<div class="input-group-prepend"><span class="input-group-text"><img src="{% static 'images/profile_phone_icon.svg' %}"></span></div>').insertBefore(backup_phone_input);
      $("label[for='id_setup-number']").remove();
      $("ul#id_setup-method").prev().remove();

      $("label[for='id_setup-method_0']").addClass('form-check');
      $("label[for='id_setup-method_0'] input").addClass('form-check-input');

      $("label[for='id_setup-method_1']").addClass('form-check');
      $("label[for='id_setup-method_1'] input").addClass('form-check-input');

      backup_token_input.wrap('<div class="input-group mb-3 backup_input_container"></div>').addClass("form-control").attr({
        "placeholder": "Enter Token",
      });
      $('<div class="input-group-prepend"><span class="input-group-text"><img src="{% static 'images/profile_token_icon.svg' %}"></span></div>').insertBefore(backup_token_input);
      $("label[for='id_validation-token']").remove();
      $(".backup_phone_group table").css("display", "none");

      // hide default error message
      $('div.backup_phone_group').find('ul.errorlist').css("display", "none");
    });
  </script>
{% endblock %}