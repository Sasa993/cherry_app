{% extends "two_factor/_base_focus.html" %}
{% load i18n %}
{% load static %}
{% block title %}{% trans "Enable Two-Factor Authentication" %}{% endblock %}

{% block content %}
  <div class="two_fa_settings_form mt-4">
    <div class="row">
    <div class="col-12 col-md-8 offset-md-2">
      <div class="card-body two_fa_settings_header">
        <h3 class="mb-1">{% trans "ENABLE 2FA" %}</h3>
      </div>
      <div class="card-body">
        {% if wizard.steps.current == 'welcome' %}
          <p>{% blocktrans %}You are about to take your account security to the
              next level. Follow the steps in this wizard to enable two-factor
              authentication.{% endblocktrans %}</p>
        {% elif wizard.steps.current == 'method' %}
          <h5 class="text-center mb-4">{% blocktrans %}Please select which authentication method you would
              like to use.{% endblocktrans %}</h5>
        {% elif wizard.steps.current == 'generator' %}
          <p>{% blocktrans %}To start using a token generator, please use your
              smartphone to scan the QR code below. For example, use Google
              Authenticator. Then, enter the token generated by the app.
              {% endblocktrans %}</p>
          <p class="text-center"><img src="{{ QR_URL }}" alt="QR Code" /></p>
        {% elif wizard.steps.current == 'sms' %}
          <p>{% blocktrans %}Please enter the phone number you wish to receive the
            text messages on. This number will be validated in the next step.
            {% endblocktrans %}</p>
        {% elif wizard.steps.current == 'call' %}
          <p>{% blocktrans %}Please enter the phone number you wish to be called on.
            This number will be validated in the next step. {% endblocktrans %}</p>
        {% elif wizard.steps.current == 'validation' %}
          {% if challenge_succeeded %}
            {% if device.method == 'call' %}
              <p>{% blocktrans %}We are calling your phone right now, please enter the
                digits you hear.{% endblocktrans %}</p>
            {% elif device.method == 'sms' %}
              <p>{% blocktrans %}We sent you a text message, please enter the tokens we
                sent.{% endblocktrans %}</p>
            {% endif %}
          {% else %}
            {% url 'sendemail:email' as url_contactus %}
            <p class="alert alert-warning" role="alert">{% blocktrans %}We've
              encountered an issue with the selected authentication method. Please
              go back and verify that you entered your information correctly, try
              again, or use a different authentication method instead. If the issue
              persists, <a href="{{ url_contactus }}">contact</a> the site administrator.{% endblocktrans %}</p>
          {% endif %}
        {% elif wizard.steps.current == 'yubikey' %}
          <p>{% blocktrans %}To identify and verify your YubiKey, please insert a
            token in the field below. Your YubiKey will be linked to your
            account.{% endblocktrans %}</p>
        {% endif %}

        <form action="" method="post">{% csrf_token %}
          {% for field in form %}
            {% if field.errors %}
              <div class="custom_alert custom_alert-danger">
                {{ field.errors }}
              </div>
            {% endif %}
          {% endfor %}
          {% include "two_factor/_wizard_forms.html" %}


          {# hidden submit button to enable [enter] key #}
          <div style="margin-left: -9999px; position: absolute;"><input type="submit" value=""/></div>

          {% include "two_factor/_wizard_actions_enable_2fa.html" %}
        </form>
      </div>
    </div>
  </div>
  </div>
{% endblock %}

{% block other_js %}
  <script>
    $(document).ready(function(){
      var main_div = $('tbody');
      var first_method = $('#id_method-method_0');
      var second_method = $('#id_method-method_1');
      var third_method = $('#id_method-method_2');

      var setup_sms_input = $('#id_sms-number');
      var setup_call_input = $('#id_call-number');
      var backup_token_input = $('#id_validation-token');
      var setup_generator_input = $('#id_generator-token');

      main_div.find("li").css("font-weight", 500);
      // $("table").find("td").css("display", "inline-block");
      $("table").find("th").css("display", "none");
      $("ul#id_method-method").css({"list-style-type": "none", "padding-inline-start": 0});

      main_div.wrap('<div class="cntr"><div class="form-group text-center checkbox_option mb-4"></div></div>');
      $("th label[for='id_method-method_0']").addClass("custom_backup_phone_method");
      $("li label[for='id_method-method_0']").addClass("btn-radio form-check-label");
      $('<svg width="20px" height="20px" viewBox="0 0 20 20"><circle cx="10" cy="10" r="9"></circle><path d="M10,7 C8.34314575,7 7,8.34314575 7,10 C7,11.6568542 8.34314575,13 10,13 C11.6568542,13 13,11.6568542 13,10 C13,8.34314575 11.6568542,7 10,7 Z" class="inner"></path><path d="M10,1 L10,1 L10,1 C14.9705627,1 19,5.02943725 19,10 L19,10 L19,10 C19,14.9705627 14.9705627,19 10,19 L10,19 L10,19 C5.02943725,19 1,14.9705627 1,10 L1,10 L1,10 C1,5.02943725 5.02943725,1 10,1 L10,1 Z" class="outer"></path></svg>').insertAfter(first_method);
      $("li label[for='id_method-method_1']").addClass("btn-radio form-check-label");
      $('<svg width="20px" height="20px" viewBox="0 0 20 20"><circle cx="10" cy="10" r="9"></circle><path d="M10,7 C8.34314575,7 7,8.34314575 7,10 C7,11.6568542 8.34314575,13 10,13 C11.6568542,13 13,11.6568542 13,10 C13,8.34314575 11.6568542,7 10,7 Z" class="inner"></path><path d="M10,1 L10,1 L10,1 C14.9705627,1 19,5.02943725 19,10 L19,10 L19,10 C19,14.9705627 14.9705627,19 10,19 L10,19 L10,19 C5.02943725,19 1,14.9705627 1,10 L1,10 L1,10 C1,5.02943725 5.02943725,1 10,1 L10,1 Z" class="outer"></path></svg>').insertAfter(second_method);
      $("li label[for='id_method-method_2']").addClass("btn-radio form-check-label");
      $('<svg width="20px" height="20px" viewBox="0 0 20 20"><circle cx="10" cy="10" r="9"></circle><path d="M10,7 C8.34314575,7 7,8.34314575 7,10 C7,11.6568542 8.34314575,13 10,13 C11.6568542,13 13,11.6568542 13,10 C13,8.34314575 11.6568542,7 10,7 Z" class="inner"></path><path d="M10,1 L10,1 L10,1 C14.9705627,1 19,5.02943725 19,10 L19,10 L19,10 C19,14.9705627 14.9705627,19 10,19 L10,19 L10,19 C5.02943725,19 1,14.9705627 1,10 L1,10 L1,10 C1,5.02943725 5.02943725,1 10,1 L10,1 Z" class="outer"></path></svg>').insertAfter(third_method);

      setup_sms_input.wrap('<div class="input-group mb-3 backup_input_container"></div>').addClass("form-control").attr({
        "placeholder": "Phone Number",
      });
      $('<div class="input-group-prepend"><span class="input-group-text"><img src="{% static 'images/profile_phone_icon.svg' %}" style="width: 19px"></span></div>').insertBefore(setup_sms_input);
      setup_call_input.wrap('<div class="input-group mb-3 backup_input_container"></div>').addClass("form-control").attr({
        "placeholder": "Phone Number",
      });
      $('<div class="input-group-prepend"><span class="input-group-text"><img src="{% static 'images/profile_phone_icon.svg' %}" style="width: 19px"></span></div>').insertBefore(setup_call_input);
      setup_generator_input.wrap('<div class="input-group mb-3 backup_input_container"></div>').addClass("form-control").attr({
        "placeholder": "Enter QR Generated Token",
      });
      $('<div class="input-group-prepend"><span class="input-group-text"><img src="{% static 'images/profile_token_icon.svg' %}" style="width: 19px;"></span></div>').insertBefore(setup_generator_input);
      backup_token_input.wrap('<div class="input-group mb-3 backup_input_container"></div>').addClass("form-control").attr({
        "placeholder": "Enter Token",
      });
      $('<div class="input-group-prepend"><span class="input-group-text"><img src="{% static 'images/profile_token_icon.svg' %}" style="width: 19px;"></span></div>').insertBefore(backup_token_input);
    });
  </script>
{% endblock %}
