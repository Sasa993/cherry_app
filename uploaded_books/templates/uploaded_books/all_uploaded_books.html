{% extends "books/base.html" %}

{% load i18n %}
{% load static %}
{% load shorten_book_title %}

{% block title %} 
	{% trans "All Uploaded Books" %} 
{% endblock %}

{% block other_css %}
	<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
	<style>
		select{
        	font-family: fontAwesome
    	}
	</style>
{% endblock %}

{% block content %}
<div class="upload_books_front mt-4">
	<div class="row">
		<div class="col-12 col-md-8 offset-md-2">
		    <div class="card-body upload_books_front_header">
		    	<h3 class="mb-1">{% trans "BOOK UPLOAD" %}</h3>
		    </div>
		    <div class="card-body">
		    	<div class="upload_books_btn_container text-center">
					<div class="custom_all_upload_books_container">
						<h6 class="text-center">{% trans 'In order to create a new book - click on the first cover with a "+" sign. If you want to order the displayed books - choose the order type.' %}</h6>
						<select class="form-control" id="sort_books">
							<option value="uploaded_at" selected="true">{% trans "Uploaded" %} &#xf175;</option>
							<option value="-uploaded_at">{% trans "Uploaded" %} &#xf176;</option>
							<option value="modified_at">{% trans "Modifed" %} &#xf175;</option>
							<option value="-modified_at">{% trans "Modifed" %} &#xf176;</option>
							<option value="title">{% trans "Title" %} &#xf175;</option>
							<option value="-title">{% trans "Title" %} &#xf176;</option>
							<option value="author">{% trans "Author" %} &#xf175;</option>
							<option value="-author">{% trans "Author" %} &#xf176;</option>
						</select>
						{% if all_books %}
							<div class="row justify-content-center align-items-center mt-4" id="ajax_display_all_books">
								{% for book in all_books %}
									{% if forloop.counter == 1 %}
										<div class="col-3">
											<a href="{% url 'dashboard:enter_new_book' %}">
												<div class="all-uploaded-books-book custom_margin_auto">
													<img src='{% static "images/create_new_book_cover.jpg" %}' alt="" />
												</div>
												<div class="custom_card_main_div">
													<div class="custom_card_all_uploaded_books">
													  <div class="card__container hvr-bounce-to-bottom">
													    <h1 class="card__title">{% trans "Create New Book" %}</h1>
													    <p class="card__subtitle">
													    	{% trans "Click here in order to create a new book" %}
													    </p>
													  </div>
													</div>
												</div>
											</a>
										</div>
									{% endif %}
									<div class="col-3">
										<a href="{{ book.id }}">
												<div class="all-uploaded-books-book custom_margin_auto">
													{% if book.cover %}
														<img src="/media/{{ book.cover }}" alt="" />
													{% else %}
														<img src="/static/images/no_cover_cover.jpg" alt="" />
													{% endif %}
												</div>
											<div class="custom_card_main_div">
												<div class="custom_card_all_uploaded_books">
												  <div class="card__container hvr-bounce-to-bottom">
												    <h1 class="card__title">{{ book.title|shorten_book_title }}</h1>
												    <p class="card__subtitle">
												    	{% if book.author.all %}
												    		By
															{% for author in book.author.all %}
																{% if forloop.last %}<span>{{ author }}</span>{% else %}<span>{{ author }},</span>{% endif %}
															{% endfor %}
														{% else %}
															{% trans "Author Not Assigned" %}
														{% endif %}
												    </p>
												  </div>
												</div>
											</div>
										</a>
									</div>
								{% endfor %}
							</div>
							<!-- pagination -->
				            <div class="pagination_container mt-4">
				            	<nav class="mt-5 d-flex d-flex justify-content-center">
				                	<ul class="pagination">
				                    	{% if all_books.has_previous %}
				                      		<li class="page-item prev_arrow">
				                        		<a class="prev arrow" href="?page={{ all_books.previous_page_number }}{% if request.GET.s_book %}&s_book={{ request.GET.s_book }}{% endif %}" tabindex="-1"></a>
				                      		</li>
				                    	{% else %}
				                      		<li class="page-item prev_arrow custom_disabled">
				                        		<a class="prev arrow" href="#!" tabindex="-1"></a>
				                      		</li>
				                    	{% endif %}

				                    	{% for i in all_books.paginator.page_range %}
				                      		{% if all_books.number == i %}
				                        		<li class="page-item custom_active">
				                          			<a class="page-link" href="#!">{{ i }}</a>
				                        		</li>
				                      		{% else %}
				                        		<li class="page-item">
				                          			<a class="page-link" href="?page={{ i }}{% if request.GET.q %}&s_book={{ request.GET.q }}{% endif %}">{{ i }}</a>
				                        		</li>
				                      		{% endif %}
				                    	{% endfor %}

				                    	{% if all_books.has_next %}
				                      		<li class="page-item next_arrow">
				                        		<a class="next arrow" href="?page={{ all_books.next_page_number }}{% if request.GET.s_book %}&s_book={{ request.GET.s_book }}{% endif %}"></a>
				                      		</li>
				                    	{% else %}
				                      		<li class="page-item next_arrow custom_disabled">
				                        		<a class="next arrow" href="#!"></a>
				                      		</li>
				                    	{% endif %}                  
				                  	</ul>
				                </nav>
				            </div>
				            <!-- /pagination -->
						{% else %}
							<h2 class="custom_h1_nobooks">{% trans "There's no books in our database." %}</h2>
						{% endif %}
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
{% endblock %}

{% block other_js %}
	<script>
		$(document).ready(function(){
			$('.custom_click').on('click', function(){
				$('#custom_box').slideToggle("slow");
				$('.custom_click').toggleClass('custom_promjena_buttona');
			});

			$("#sort_books").change(function(){
				$.ajax({
					type: 'GET',
					url: "{% url 'dashboard:all_uploaded_books' %}",
					data: {
						'red':$(this).val()
					},
					dataType: 'html',
					success: books_success
				});
			});
			function books_success(data, textStatus, jqXHR)
        	{
        		$('#ajax_display_all_books').html($(data).find('#ajax_display_all_books').html());
        	}
		});
	</script>
	<script src="{% static 'script/sorttable.js' %}"></script>
{% endblock %}
