{% load i18n %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>
        Workflow - {% block title %} {% endblock %}
    </title>
    <link href="https://use.fontawesome.com/releases/v5.0.6/css/all.css" rel="stylesheet">
    <!-- <link rel="stylesheet" href="css/bootstrap.min.css"> -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <link rel="stylesheet" href="{% static 'css/custom.css' %}" />
    <!-- Css For responsive -->
    <link rel="stylesheet" href="{% static 'css/responsive.css' %}" />
    <!-- <link rel="stylesheet" href="{% static '../../static/css/responsive.css' %}"> -->
    <!-- /Css For responsive -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link href="{% static 'css/toastr.css' %}" rel="stylesheet"/>
    <script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
    {% block other_css %} {% endblock %}
    {% block extrahead %} {% endblock extrahead %}
    {% block extra_js %} {% endblock extra_js %}
    <!-- These JS files need to be inside head tags to make sure that datepicker is being displayed -->
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
</head>

<body>
    <!-- above 768px width -->
    <div class="page-wrapper chiller-theme toggled">
        <a id="show-sidebar" class="btn btn-sm" href="#!">
            <i class="fas fa-bars fa-lg"></i>
        </a>
        <nav id="sidebar" class="sidebar-wrapper">
            <div class="sidebar-content">
              <div class="sidebar-header">
                <a href="/" class="navbar-brand mt-0">
                        <img class="img-fluid img-responsive" src="{% static 'images/Cherry_Media_Logo_Grey_Letter.png' %}" alt="">
                    </a>
                    <div id="close-sidebar">
                        <i class="fas fa-times"></i>
                    </div>
                </div>
                  <!-- Side Bar Search  -->
                <div class="sidebar-search">
                    <div>
                        <div class="input-group">
                            <div class="input-group-append">
                            </div>
                            <input type="text" class="form-control search-menu" placeholder='{% trans "Search Tasks" %}' aria-label="Search" name="q" value="" id="q">
                            <span class="input-group-text">
                                <i class="fa fa-search" aria-hidden="true"></i>
                            </span>
                        </div>
                    </div>
                </div>
                  <!-- Side Bar Menu  -->
                <div class="sidebar-menu">
                    <ul>
                        <li>
                            <a href="/">
                                <i class="fas fa-home"></i>
                                <span>{% trans "Home" %}</span>
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'dashboard:all_uploaded_books' %}">
                                <i class="fas fa-book"></i>
                                <span>{% trans "Books" %}</span>
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'todo:mine' %}">
                                <i class="fas fa-thumbtack"></i>
                                <span>{% trans "My Tasks" %}</span>
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'todo:lists' %}">
                                <i class="fas fa-tasks"></i>
                                <span>{% trans "All Tasks" %}</span>
                            </a>
                        </li>
                        <li class="sidebar-dropdown">
                            <a href="#!">
                                <i class="fa fa-user"></i>
                                <span>Welcome {{ request.user.username|title }}</span>
                            </a>
                            <div class="sidebar-submenu">
                                <ul>
                                    <li>
                                        <a href="{% url 'admin:index' %}">My profile</a>
                                    </li>
                                    <li>
                                        <a href="{% url 'two_factor:profile' %}">Two-Factor Settings</a>
                                    </li>
                                    <li>
                                        <a href="{% url 'account_email' %}">Change E-Mail</a>
                                    </li>
                                    <li>
                                        <a href="{% url 'account_change_password' %}">Change Password</a>
                                    </li>
                                    <li>
                                        <a href="{% url 'account_logout' %}">Logout</a>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        <li>
                            <a href="{% url 'todo:import_csv' %}">
                                <i class="fa fa-folder"></i>
                                <span>Import CSV</span>
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'sendemail:email' %}">
                                <i class="fas fa-envelope-open"></i>
                                <span>Contact Us</span>
                            </a>
                        </li>
                    </ul>
                </div>
                <!-- Progress bar -->
                <div class="progressbar_wrapper">
                    <div class="progressbar_container">
                        <div style="width:170px;height:170px; margin: 10px auto 0px;">
                            <div class="percent" style="width:170px; height:170px;">
                                <p style="display:none;">{{ all_tasks_percentage }}</p>
                            </div>
                        </div>
                        <div>
                            {% if user.is_superuser %}
                            <div class="custom_task_count">There are <span>{{ all_tasks }}</span> task{{ all_tasks|pluralize }} in total. <span>{{ all_tasks_completed }}</span> of them have been completed.</div>
                        {% else %}
                            <div class="custom_task_count">You have <span>{{ all_tasks }}</span> task{{ all_tasks|pluralize }} that have been assigned to you. You have completed <span>{{ all_tasks_completed }}</span> of them.</div>
                        {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </nav>
        <!-- sidebar-wrapper  -->
        <main class="page-content">
            <!-- Content -->
            <div class="container-fluid">
                {% block content %}

                {% endblock %}
            </div>
            <!-- Footer -->
            <footer class="fixed-bottom">
                <section class="copyright">
                    <div class="container">
                        <div class="row text-center justify-content-center">
                            <div class="col-xs-12 col-md-6 mt-1">
                                <ul class="useful-links">
                                    <li><a href="#!">Privacy</a></li>
                                    <li><a href="#!">Terms and Conditions</a></li>
                                    <li><a href="#!l">Sitemap</a></li>
                                </ul>
                            </div>
                            <div class="col-md-6 mt-1">
                                <p>Â© <script>document.write(new Date().getFullYear());</script> Cherry Media. All Rights Reserved</p>
                            </div>
                        </div>
                    </div>
                </section>
            </footer>
        </main>
    </div>
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <!--<script src="{% static 'script/jquery.min.js' %}"></script>-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <!-- <script src="script/bootstrap.min.js"></script> -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="{% static 'script/jQuery.circleProgressBar.min.js' %}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.4/raphael-min.js"></script>
    <script src="{% static 'script/script.js' %}"></script>
    <script src="{% static 'script/toastr.js' %}"></script>
    {% block other_js %} {% endblock %}

    <script>
        $(function() {
            // Sidebar open if the screen width is higher than 767
            var screen_width = $(window).width();
            check_screen_width(screen_width);
            
            $(window).resize(function(){
               screen_width = $(window).width();
               check_screen_width(screen_width);
            })

            function check_screen_width(w) {
                if(w <= 767){
                    $('.page-wrapper').removeClass('toggled');
                }
                else{
                    $('.page-wrapper').addClass('toggled');
                }
            };

            //RealTime Search Bar Implementation
            // if the urls contains string "search" it will place "focus" on the input
            if (window.location.href.indexOf("search") > -1) {
                $('#q').focus();
                // to make sure that the sidebar stays open if we are typing search keywords
                $('.page-wrapper').addClass('toggled');
            }

            if (window.location.href.indexOf("search/?page") > -1 && screen_width <= 767) {
                $('.page-wrapper').removeClass('toggled');
            }
    
            $('#q').click(function(){
                if (window.location.href.indexOf("search") <= -1) {
                    location.href = "/todo/search/?q=";
                }
            });

            $('#q').keyup(function() {
                $.ajax({
                    type: "GET",
                    url: "/todo/search/",
                    data: {
                        'q' : $('#q').val(),
                        'csrfmiddlewaretoken' : $("input[name=csrfmiddlewaretoken]").val()
                    },
                    dataType: 'html',
                    success: searchSuccess
                });
            });
        });

        function searchSuccess(data, textStatus, jqXHR)
        {
            $('.post_list').html($(data).find('.post_list').html());
        }

        // Toastr Notifications
        // erros and messages disappear after certain time - 3 secs and 10 secs
        setTimeout(function(){
            $('.alert-danger').fadeOut();
        }, 3000);

        setTimeout(function(){
            $('.custom_alert-danger').fadeOut();
        }, 10000);

        // enabling bootstrap's tooltip
        $(function () {
          $('[data-toggle="tooltip"]').tooltip();
        });

        // toastr library
        toastr.options = {
            typeBasedOverrides: {
                success: {
                    "closeButton": false,
                    "debug": false,
                    "newestOnTop": false,
                    "progressBar": true,
                    "positionClass": "toast-top-right",
                    "preventDuplicates": false,
                    "onclick": null,
                    "showDuration": "300",
                    "hideDuration": "1000",
                    "timeOut": "500",
                    "extendedTimeOut": "1000",
                    "showEasing": "swing",
                    "hideEasing": "linear",
                    "showMethod": "fadeIn",
                    "hideMethod": "fadeOut"
                },
                error: {
                    "closeButton": false,
                    "debug": false,
                    "newestOnTop": false,
                    "progressBar": true,
                    "positionClass": "toast-top-right",
                    "preventDuplicates": false,
                    "onclick": null,
                    "showDuration": "300",
                    "hideDuration": "1000",
                    "timeOut": "5000",
                    "extendedTimeOut": "1000",
                    "showEasing": "swing",
                    "hideEasing": "linear",
                    "showMethod": "fadeIn",
                    "hideMethod": "fadeOut"
                },
              }
            };
    </script>
</body>
</html>