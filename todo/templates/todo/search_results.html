{% extends "todo/base.html" %}

{% load i18n %}

{% block title %}
  {% trans "Search Results" %}
{% endblock %}

{% block content %}
  <div class="search_results mt-4">
    <div class="row">
      <div class="col-12 col-md-8 offset-md-2 col-lg-8 offset-lg-2">
        <div class="card-body search_results_header">
          <h3 class="mb-1">{% trans "TASKS SEARCH RESULTS" %}</h3>
        </div>
        <div class="card-body search_results_container">
          <div class="custom_whole_div_search_input">
            <div class="form-group input-group">
              <div class="input-group-prepend custom_search_tasks_input">
                <span class="input-group-text" id="basic-addon1">
                  <img src="/static/images/loupe.svg" alt="">
                </span>
              </div>
              <input type="text" class="form-control" placeholder='{% trans "Enter your keywords" %}' aria-label="Search" name="q" value="" id="q" autocomplete="off">
            </div>
            <small id="inputNameHelp" class="form-text text-muted">
              {% trans "You can search by Title, Description, Task List, Assigned by and Assigned to..." %}
            </small>
          </div>
          <div class="post_list mt-3">
            {% if found_tasks %}
              <h6 class="text-center">{% blocktrans with tasks_count=found_tasks2.count %}<strong>{{ tasks_count }}</strong> search results for term: <strong>{{ query_string }}</strong>{% endblocktrans %}</h6>
              <ul class="list-group">
                {% for f in found_tasks %}
                  <li class="list-group-item search_list_item hvr-grow-shadow">
                    <div class="row justify-content-between align-items-center list_item_wrapper">
                      <div class="col-12 col-sm-5 col-md-5 col-lg-4 col-xl-6 custom_search_task_title">
                        <a href="{% url 'todo:task_detail' f.id %}" class="hvr-icon-fade"><i class="fas fa-thumbtack hvr-icon"></i><h5>{{ f.title }}</h5></a>
                      </div>
                      <div class="col-12 col-sm-7 col-md-7 col-lg-8 col-xl-6">
                        <div class="row">
                          <p class="col-md-6 col-lg-6 col-xl-6">{% trans "In list" %}: <a href="{% url 'todo:list_detail' f.task_list.id f.task_list.slug %}" class="list_name">{{ f.task_list.name }}</a></p>
                          <p class="col-md-6 col-lg-6 col-xl-6">{% trans "Assigned to" %}: <strong style="color:#8d0a15;">{% if f.assigned_to %}{{ f.assigned_to }}{% else %}Anyone{% endif %}</strong></p>
                          <p class="col-md-6 col-lg-6 col-xl-6">{% trans "Completed" %}: 
                            {% if f.completed %}
                              <b class="completed">
                            {% else %}
                              <b class="not_completed">
                            {% endif %}
                            {% blocktrans with check_if_completed=f.completed|yesno:"Yes,No" %}{{ check_if_completed }}{% endblocktrans %}
                            </b>
                          </p>
                          <p class="col-md-6 col-lg-6 col-xl-6">{% trans "Assigned by" %}: <strong style="color:#8d0a15;">{% if f.created_by %}{{ f.created_by }}{% else %}Anyone{% endif %}</strong></p>
                        </b>
                      </div>
                    </div>
                  </li>
                {% endfor %}
              </ul>
              <!-- pagination -->
              <div class="pagination_container mt-4">
                <nav class="mt-5 d-flex d-flex justify-content-center">
                  <ul class="pagination">
                    {% if found_tasks.has_previous %}
                      <li class="page-item prev_arrow">
                        <a class="prev arrow" href="?page={{ found_tasks.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}" tabindex="-1"></a>
                      </li>
                    {% else %}
                      <li class="page-item prev_arrow custom_disabled">
                        <a class="prev arrow" href="#!" tabindex="-1"></a>
                      </li>
                    {% endif %}

                    {% for i in found_tasks.paginator.page_range %}
                      {% if found_tasks.number == i %}
                        {# <li class="active"><span>{{ i }} <span class="sr-only">(current)</span></span></li> #}
                        <li class="page-item custom_active">
                          <a class="page-link" href="#!">{{ i }}</a>
                        </li>
                      {% else %}
                        {# <li><a href="?page={{ i }}">{{ i }}</a></li> #}
                        <li class="page-item">
                          <a class="page-link" href="?page={{ i }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">{{ i }}</a>
                        </li>
                      {% endif %}
                    {% endfor %}

                    {% if found_tasks.has_next %}
                      <li class="page-item next_arrow">
                        <a class="next arrow" href="?page={{ found_tasks.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}"></a>
                      </li>
                    {% else %}
                      <li class="page-item next_arrow custom_disabled">
                        <a class="next arrow" href="#!"></a>
                      </li>
                    {% endif %}                  
                  </ul>
                </nav>
              </div>
              <!-- /pagination -->
            {% else %}
              {% if query_string %}
                <h2 class="text-center">{% blocktrans %}No results to show for term <strong>{{ query_string }}</strong>, sorry.{% endblocktrans %}</h2>
              {% else %}
                <h2 class="text-center">{%trans "Start searching by typing into an input above." %}</h2>
              {% endif %}
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
{% block other_js %}
  <script>
    $(function() {
            //RealTime Search Bar Implementation
            // if the urls contains string "search" it will place "focus" on the input
            if (window.location.href.indexOf("search") > -1) {
                $('#q').focus();
                // to make sure that the sidebar stays open if we are typing search keywords
                $('.page-wrapper').addClass('toggled');
            }

            if (window.location.href.indexOf("search/?page") > -1 && screen_width <= 767) {
                $('.page-wrapper').removeClass('toggled');
            }
    
            $('#q').click(function(){
                if (window.location.href.indexOf("search") <= -1) {
                    location.href = "/todo/search/?q=";
                }
            });

            $('#q').keyup(function() {
                $.ajax({
                    type: "GET",
                    url: "/todo/search/",
                    data: {
                        'q' : $('#q').val(),
                        'csrfmiddlewaretoken' : $("input[name=csrfmiddlewaretoken]").val()
                    },
                    dataType: 'html',
                    success: searchSuccess
                });
            });
        });
    function searchSuccess(data, textStatus, jqXHR)
        {
            $('.post_list').html($(data).find('.post_list').html());
        }
  </script>
{% endblock %}